<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <title>E commerce website</title>

    <style>
      .dropdown-toggle:after{
        display: none !important;
      }
    </style>

</head>
<body>
  <nav class="navbar navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">üõçÔ∏è Mart </a>

      <div class="cta d-flex gap-2">

      </div>

      <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasDarkNavbar" aria-labelledby="offcanvasDarkNavbarLabel">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="offcanvasDarkNavbarLabel">Dark offcanvas</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <table class="table">
              <thead>
                <tr>
                  <th>img</th>
                  <th>title</th>
                  <th>price</th>
                  <th>btn</th>
                </tr>
              </thead>
              <tbody class="cart">

              </tbody>
            </table>
         
        </div>
      </div>
    </div>
  </nav>

<br/>


  <div class="d-flex align-items-center mx-5 mt-5 shadow bg-light rounded-pill px-3">
    üîç
    <input type="text" placeholder="search" class="form-control bg-light border-0" id="search">
    üõçÔ∏è
  </div>





<!-- Modal -->


<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">üõçÔ∏è Mart </h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="px-3">

          <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">

<!-- Login form start -->
      <form id="login">
        <div class="row">
          <div class="col-12">
            <div class="input-group mb-3">
              <span class="input-group-text" id="basic-addon1">üìß</span>
              <input type="text" class="form-control" id="email1" placeholder="Email" aria-label="Username" aria-describedby="basic-addon1">
            </div>
          </div>
          <div class="col-12">
            <div class="input-group mb-3">
              <span class="input-group-text" id="basic-addon1">üîí</span>
              <input type="text" class="form-control" id="password1" placeholder="Password" aria-label="Username" aria-describedby="basic-addon1">
            </div>
          </div>
          <div class="col-12 text-center">
            <button class="btn btn-secondary px-5">Login</button>
          </div>
        </div>
      </form>
<!-- Login form end -->

      </div>

      <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
  
<!-- Registration form start -->
          <form id="register">
            <div class="row">
              <div class="col-12">
                <div class="input-group mb-3">
                  <span class="input-group-text" id="basic-addon1">üßëüèª‚Äçüíº</span>
                  <input type="text" class="form-control" id="name" placeholder="Username" aria-label="Username" aria-describedby="basic-addon1">
                </div>
              </div>
              <div class="col-12">
                <div class="input-group mb-3">
                  <span class="input-group-text" id="basic-addon1">üìß</span>
                  <input type="text" class="form-control" id="email" placeholder="Email" aria-label="Username" aria-describedby="basic-addon1">
                </div>
              </div>
              <div class="col-12">
                <div class="input-group mb-3">
                  <span class="input-group-text" id="basic-addon1">üìû</span>
                  <input type="text" class="form-control" id="phone" placeholder="Phone" aria-label="Username" aria-describedby="basic-addon1">
                </div>
              </div>
              <div class="col-12">
                <div class="input-group mb-3">
                  <span class="input-group-text" id="basic-addon1">üîí</span>
                  <input type="text" class="form-control" id="password" placeholder="Password" aria-label="Username" aria-describedby="basic-addon1">
                </div>
              </div>
              <div class="col-12 text-center">
                <button type="submit" class="btn btn-secondary px-5">Register</button>
              </div>
            </div>
          </form>
<!-- Registration form end -->

            </div>

          </div>


        </div>
      </div>
      <div class="modal-footer">
          <ul class="nav nav-underline" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">Login</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false">Register</button>
            </li>
      
          </ul>
      </div>
    </div>
  </div>
</div>





        <div class="pt-4">
          <div class="container p-2">
            <button class="btn btn-outline-secondary" id="viewall">all</button>
            <button class="btn btn-outline-secondary" id="mens">mens</button>
            <button class="btn btn-outline-secondary" id="jewelery">jewelery</button>
            <button class="btn btn-outline-secondary" id="price_sort">Price_Sort</button>
          </div>
          
        </div>
    <div class="container">
        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-2 g-md-3 g-lg-4" id="boxes">
        </div>
    </div>





  

    <script>

     let curUser = JSON.parse(localStorage.getItem("curUser"));
     document.querySelector(".cta").innerHTML = `
     
            ${ curUser && `<button onclick="showCart()" class="navbar-toggler bg-dark" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar" aria-label="Toggle navigation">
              <span id="cartlength"></span> üõí 
             </button>
             `}
       ${ curUser 
         ?
          `
             <div class="dropdown">
              <button class="btn btn-secondary dropdown-toggle rounded-circle" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="::after { display:none !important; }" >
                <i class="fa-solid fa-user-tie"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="#">${curUser.name}</a></li>
                <li><a class="dropdown-item" href="#">${curUser.email}</a></li>
                 <li><hr class="dropdown-divider"></li>
                <li class="text-end">
                    <button type="button" onclick="logOut()" class="navbar-toggler btn btn-danger active text-light fs-5 me-2" data-bs-toggle="modal" data-bs-target="#exampleModal">
                    <i class="fa-solid fa-right-from-bracket"></i>
                  </button>  
                </li>
              </ul>
            </div>
          `
          :
            `  <button type="button" class="navbar-toggler bg-success text-light fs-5" data-bs-toggle="modal" data-bs-target="#exampleModal">
               login <i class="fa-solid fa-arrow-right-to-bracket"></i>
             </button>
             `
             }
     `

     function logOut(){
      localStorage.removeItem("curUser");
      location.reload();
     }
     
     </script>
    
</body>

<script src="data.js"></script>



<script>





const setCartData = (d) =>{
  localStorage.setItem("cartData", JSON.stringify(d))
}



let search = document.getElementById("search")

  search.addEventListener("keyup", function(e){
    let val = e.target.value.toUpperCase();
    
    let searchData = data.filter((ele) => !ele.title.toUpperCase().indexOf(val) || !ele.category.toUpperCase().indexOf(val))
 console.log(searchData)

    showData(searchData);

  })





let boxes = document.querySelector("#boxes")


let mens= document.querySelector("#mens");
let viewall= document.querySelector("#viewall");
let jewelery = document.querySelector("#jewelery")
let price_sort = document.querySelector("#price_sort");



price_sort.addEventListener("click", ()=>{
    // let getData = data.map((ele) => ele.price.sort());

    data.sort((a, b) => a.price - b.price);
    let getData = data;
    showData(getData)

    // let , amul, joke, amit
    // amit, amul, let, joke
})

jewelery.addEventListener("click", ()=>{
    let getData = data.filter((ele)=> ele.category=="jewelery");
    showData(getData)
})

mens.addEventListener("click", ()=>{
   let getData = data.filter((ele) => ele.category=="men's clothing");
    console.log(getData) ;
    showData(getData)
})


viewall.addEventListener("click", ()=>{
   let getData = data.map((ele) => ele);
    console.log(getData) ;
    showData(getData)
})




let cartData = JSON.parse(localStorage.getItem("cartData")) || []
window.onload= showData(data);
window.onload = showCart(cartData)




function incCount(id){
    cartData =  cartData.map((ele) => {
      if(ele.id == id){
        ele.quentity += 1;
      }
      return ele;
    })

    localStorage.setItem("cartData", JSON.stringify(cartData));

    showCart();
    showData(data)
}


function descCount(id){
    cartData =  cartData.map((ele) => {
      if(ele.id == id){
        if(ele.quentity > 1){
              ele.quentity -= 1;
        }
        else{
          return ele = null;
        }
 
      }
      return ele;
    }).filter((ele) => ele != null)

    localStorage.setItem("cartData", JSON.stringify(cartData));

    showCart();
    showData(data)
}


function removeItem(id){

  let remcartData = cartData.filter((ele) => ele.id != id);
 setCartData(remcartData)

showCart();

  
}



function checkCart(id){

  let cartData = JSON.parse(localStorage.getItem("cartData")) || []

  cartData = cartData.filter((ele) => ele.id == id)

  return !cartData[0]
}



function checkQtn(id){

  let cartData = JSON.parse(localStorage.getItem("cartData")) || []

  cartData = cartData.filter((ele) => ele.id == id)

  return cartData[0].quentity;
}





function addCart(id){

  let curUser = JSON.parse(localStorage.getItem("curUser"));

  if(curUser)
  {
    let newcartData = data.filter((ele) => ele.id == id).map((ele) => {
        if(ele.id == id){
          ele.quentity = 1; 
        }
      return ele;
      })

      cartData = [...cartData, ...newcartData]
      console.log(cartData)
    
      setCartData(cartData)

      document.getElementById("cartlength").innerHTML = cartData.length

      showData(data)
  }
  else
  {
                 
    let myModal = new bootstrap.Modal(document.querySelector("#exampleModal"))
          myModal.show();
  }

}


document.getElementById("cartlength").innerHTML = cartData.length;






function showData(getData){

        boxes.innerHTML = "";

    getData.map((ele)=> {

     boxes.innerHTML += `
     <div class="col ">
      <div class="card border-0 shadow p-2 h-100" >
      <img style="aspect-ratio:1/1" src=${ele.image} class="card-img-top img-thumbnail p-2" alt="...">
      <div class="card-body p-0 pt-1">
        <h6 class="card-title">${ele.title}</h6>
       
        <div class="d-flex justify-content-between">
           <span class="badge text-bg-secondary"> $ ${ele.price} /-</span>
           <span class="badge text-bg-light d-flex"><span style="display:block; overflow:hidden; width:${ele.rating.rate*16}px">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span> ${ele.rating.rate}</span>
        </div>
        <div class="d-flex gap-2 pt-3">
        ${
          ( !checkCart(ele.id) && curUser)
           ?
            ` <div class="btn-group">
                    <button onclick="incCount(${ele.id})" class="btn btn-dark btn-sm">+</button>
                    <button class="btn btn-outline-dark disabled text-dark btn-sm">${checkQtn(ele.id)}</button>
                    <button onclick="descCount(${ele.id})" class="btn btn-danger btn-sm btn-md-lg">-</button>
               </div>`
             :
              `
              <div class="text-center">
                <button onclick="addCart(${ele.id})" class="btn btn-success btn-sm btn-md-lg">Add to Cart</button>
              </div>
              `}
              <div class="text-center">
                <button onclick="addCart(${ele.id})" class="btn btn-warning btn-sm">More</button>
              </div>
        </div>
        
      </div>
    </div>
</div>
     `
})

}



 cartData = JSON.parse(localStorage.getItem("cartData"))





function showCart(){
 let cartData = JSON.parse(localStorage.getItem("cartData"))

  let cart = document.querySelector(".cart");
  cart.innerHTML = "";

  cartData.map((ele) => {
  cart.innerHTML += `
             <tr>
                <td><img class="img-fluid" src=${ele.image} alt="${ele.title}" /></td>
                <td>${ele.title}</td>
                <td class="ptotal">${ele.price*ele.quentity}</td>
                <td>
                  <div class="btn-group">
                    <button onclick="incCount(${ele.id})" class="btn btn-dark btn-sm">+</button>
                    <button class="btn btn-outline-dark disabled text-dark btn-sm">${ele.quentity}</button>
                    <button onclick="descCount(${ele.id})" class="btn btn-danger btn-sm">-</button>
                  </div>
                </td>
                <td>
                  
                    <button onclick="removeItem(${ele.id})" class="btn-close"></button>  
                </td>
              </tr>
  
  `
})

}



</script>


<script>

  let register = [];
  document.getElementById("register").addEventListener("submit", function(e){
   e.preventDefault();
  
   let obj = {
      name: document.querySelector("#name").value,
      email: document.querySelector("#email").value,
      phone: document.querySelector("#phone").value,
      password: document.querySelector("#password").value,
   }
  
   register = JSON.parse(localStorage.getItem("register")) || []
  
    let log = register.filter((ele) => {
      if(ele.email == obj.email && ele.password == obj.password){
         return ele;
      }
      })
  
   if(log[0]){
          alert("user already exist");
   }
  else if(obj.name != "" && obj.email !="" && obj.phone !="" && obj.password != "")
  {


    localStorage.setItem("curUser", JSON.stringify(obj));
  
  register.push(obj);
  
  localStorage.setItem("register", JSON.stringify(register));
  
  let myModal = new bootstrap.Modal(document.querySelector("#exampleModal"))
  myModal.hide();

  location.reload()

  
  }else{
   alert("Please register first")
  }
  
  }
  )
  
  
  document.getElementById("login").addEventListener("submit", function(e){
   e.preventDefault();
  
   let objlog = {
      email: document.querySelector("#email1").value,
      password: document.querySelector("#password1").value
   }
  if( objlog.email !="" && objlog.password != "")
  {
  
   register = JSON.parse(localStorage.getItem("register"))
  
    let log = register.filter((ele) => {
      if(ele.email == objlog.email && ele.password == objlog.password){
         return ele;
      }
      })

      localStorage.setItem("curUser", JSON.stringify(log))
  
      if(log[0]){
          let curUser = log[0];
          localStorage.setItem("curUser", JSON.stringify(curUser));
          
          let myModal = new bootstrap.Modal(document.querySelector("#exampleModal"))
          myModal.hide();

          location.reload()

      }
      else{
          alert("user not register")
      }
  
  }else{
   alert("Please Login first")
  }
  
  }
  )
  
  
  </script>


</html>
